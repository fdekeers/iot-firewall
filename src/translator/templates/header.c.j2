{% set policy_jinja = policy.replace('-', '_') %}
// THIS FILE HAS BEEN AUTOGENERATED. DO NOT EDIT.

/**
 * Nefilter queue for device {{device}} and policy {{policy_jinja}}
 */

// Standard libraries
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
{% if max_threads > 1 %}
#include <pthread.h>
#include <assert.h>
{% endif %}
// Custom libraries
#include "nfqueue.h"
#include "packet_utils.h"
#include "nft_counter.h"
// Parsers
#include "parsers/header.h"
{% for parser in custom_parsers %}
{% if parser == "mdns" %}
#include "parsers/dns.h"
{% else %}
#include "parsers/{{parser}}.h"
{% endif %}
{% endfor %}

// Constants
{% if max_threads > 1 %}
#define MAX_THREADS {{max_threads}}
{% endif %}
#define NUM_STATES  {{states|length}}
#define NFQ_ID_BASE {{nfq_id_base}}

typedef enum {
{% for state in states %}
    {{state}},
{% endfor %}
} state_t;

state_t state = {{states[0]}};
{% if max_threads > 1 %}
uint8_t num_threads = 0;
pthread_mutex_t mutex;
{% endif %}

