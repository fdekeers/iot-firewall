---
device-info:
  device-name: xiaomi-cam
  mac-address: 78:8b:2a:b2:20:ea
  ip-address: 192.168.1.161
  mud-version: 1
  mud-url: https://xiaomi-cam.com/xiaomi-cam
  last-update: "2022-03-15T10:27:29.170+01:00"
  cache-validity: 100
  is-supported: true


individual-policies:

  ##### BOOT TRAFFIC #####

  http-xiaomi-cloud:
    protocols:
      http:
        method: GET
        uri: /gslb?tver=2&id=369215617&dm=ots.io.mi.com&timestamp=8&sign=j2zt3%2BpbAwcxrxovQUFtCyZ6DUmGplXNKr1i8jteRb4%3D
      tcp:
        dst-port: 80
        initiated-by: self
      ipv4:
        src: self
        dst:
          - 110.43.0.83
          - mdns
    direction: both
  
  https-xiaomi-cloud:
    protocols:
      tcp:
        dst-port: 443
        initiated-by: self
      ipv4:
        src: self
        dst: 120.92.133.153
    direction: both

  dns-xiaomi-api:
    protocols:
      dns:
        qtype: A
        domain-name: business.smartcamera.api.io.mi.com
      udp:
        dst-port: 53
      ipv4:
        src: self
        dst: gateway
    direction: both

  ##### IDLE TRAFFIC #####

  arp-request-from-gateway:
    protocols:
      arp:
        type: request
        sha: gateway
        tha: default
        spa: gateway
        tpa: self
    direction: both

  udp-xiaomi-cloud:
    protocols:
      udp:
      ipv4:
        src: self
        dst:
          - 36.156.49.100
          - 42.157.165.140
          - 45.124.124.68
          - 110.43.39.29
          - 110.43.68.58
          - 120.92.133.153
          - 120.92.162.194
    direction: both

  ping-quad8:
    protocols:
      icmp:
        type: echo-request
      ipv4:
        src: self
        dst: 8.8.8.8
    direction: both
    stats:
      number-of-packets:
        out: 1
        in: 1


interaction-policies:

  get-ip-address:

    dhcp-discover:
      protocols:
        dhcp:
          type: discover
          client-mac: self
        udp:
          src-port: 68
          dst-port: 67
        ipv4:
          src: 0.0.0.0
          dst: broadcast
      direction: out

    dhcp-offer:
      protocols:
        dhcp:
          type: offer
          client-mac: self
        udp:
          src-port: 67
          dst-port: 68
        ipv4:
          src: gateway
          dst: self
      direction: in
    
    dhcp-request:
      protocols:
        dhcp:
          type: request
          client-mac: self
        udp:
          src-port: 68
          dst-port: 67
        ipv4:
          src: 0.0.0.0
          dst: broadcast
      direction: out

    dhcp-ack:
      protocols:
        dhcp:
          type: ack
          client-mac: self
        udp:
          src-port: 67
          dst-port: 68
        ipv4:
          src: gateway
          dst: self
      direction: in

  ##### DISCOVER GATEWAY AT BOOT #####
  discover-gateway:

    arp-request:
      protocols:
        arp:
          type: request
          sha: self
          tha: default
          spa: self
          tpa: gateway
      direction: out
  
    arp-reply:
      protocols:
        arp:
          type: reply
          sha: gateway
          tha: self
          spa: gateway
          tpa: self
      direction: in
  
  ##### OPEN XIAOMI APP #####
  open-app-local:

    igmp-phone:
      protocols:
        igmp:
          type: membership report
          group: mdns
        ipv4:
          src: local
          dst: mdns
      direction: out

    mdns-phone:
      protocols:
        mdns:
          qtype: PTR
          domain-name:
            - _miio._udp.local
            - _rc._tcp.local
        udp:
          src-port: 5353
          dst-port: 5353
        ipv4:
          src: local
      direction: out

    udp-phone-broadcast:
      protocols:
        udp:
          dst-port:
            - 54321
            - 32108
        ipv4:
          src: local
          dst: broadcast
      direction: out

    arp-xiaomi-phone-request:
      protocols:
        arp:
          type: request
          sha: self
          tha: default
          spa: self
          tpa: local
      direction: out

    arp-xiaomi-phone-reply:
      protocols:
        arp:
          type: reply
          tha: self
          spa: local
          tpa: self
      direction: in

    udp-xiaomi-phone-burst-open:
      protocols:
        udp:
        ipv4:
          src: self
          dst: local
      direction: both
      stats:
        duration: 1 s
        number-of-packets: 20
        payload-size: 4 - 250
...